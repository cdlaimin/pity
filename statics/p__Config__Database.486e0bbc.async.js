"use strict";(self.webpackChunkpity=self.webpackChunkpity||[]).push([[3929],{16165:function(x,E,e){var a=e(1413),s=e(4942),m=e(45987),t=e(67294),v=e(93967),u=e.n(v),P=e(63017),i=e(56736),p=["className","component","viewBox","spin","rotate","tabIndex","onClick","children"],r=t.forwardRef(function(o,O){var g=o.className,d=o.component,M=o.viewBox,y=o.spin,B=o.rotate,Z=o.tabIndex,I=o.onClick,f=o.children,L=(0,m.Z)(o,p);(0,i.Kp)(Boolean(d||f),"Should have `component` prop or `children`."),(0,i.C3)();var U=t.useContext(P.Z),W=U.prefixCls,F=W===void 0?"anticon":W,K=U.rootClassName,S=u()(K,F,g),V=u()((0,s.Z)({},"".concat(F,"-spin"),!!y)),N=B?{msTransform:"rotate(".concat(B,"deg)"),transform:"rotate(".concat(B,"deg)")}:void 0,T=(0,a.Z)((0,a.Z)({},i.vD),{},{className:V,style:N,viewBox:M});M||delete T.viewBox;var $=function(){return d?t.createElement(d,(0,a.Z)({},T),f):f?((0,i.Kp)(Boolean(M)||t.Children.count(f)===1&&t.isValidElement(f)&&t.Children.only(f).type==="use","Make sure that you provide correct `viewBox` prop (default `0 0 1024 1024`) to the icon."),t.createElement("svg",(0,a.Z)((0,a.Z)({},T),{},{viewBox:M}),f)):null},R=Z;return R===void 0&&I&&(R=-1),t.createElement("span",(0,a.Z)((0,a.Z)({role:"img"},L),{},{ref:O,tabIndex:R,onClick:I,className:S}),$())});r.displayName="AntdIcon",E.Z=r},91321:function(x,E,e){e.d(E,{Z:function(){return p}});var a=e(1413),s=e(45987),m=e(67294),t=e(16165),v=["type","children"],u=new Set;function P(r){return Boolean(typeof r=="string"&&r.length&&!u.has(r))}function i(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,O=r[o];if(P(O)){var g=document.createElement("script");g.setAttribute("src",O),g.setAttribute("data-namespace",O),r.length>o+1&&(g.onload=function(){i(r,o+1)},g.onerror=function(){i(r,o+1)}),u.add(O),document.body.appendChild(g)}}function p(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=r.scriptUrl,O=r.extraCommonProps,g=O===void 0?{}:O;o&&typeof document!="undefined"&&typeof window!="undefined"&&typeof document.createElement=="function"&&(Array.isArray(o)?i(o.reverse()):i([o]));var d=m.forwardRef(function(M,y){var B=M.type,Z=M.children,I=(0,s.Z)(M,v),f=null;return M.type&&(f=m.createElement("use",{xlinkHref:"#".concat(B)})),Z&&(f=Z),m.createElement(t.Z,(0,a.Z)((0,a.Z)((0,a.Z)({},g),I),{},{ref:y}),f)});return d.displayName="Iconfont",d}},8751:function(x,E,e){e.d(E,{Z:function(){return i}});var a=e(1413),s=e(67294),m={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M699 353h-46.9c-10.2 0-19.9 4.9-25.9 13.3L469 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H325c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8a31.8 31.8 0 0051.7 0l210.6-292c3.9-5.3.1-12.7-6.4-12.7z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"check-circle",theme:"outlined"},t=m,v=e(84089),u=function(r,o){return s.createElement(v.Z,(0,a.Z)((0,a.Z)({},r),{},{ref:o,icon:t}))},P=s.forwardRef(u),i=P},18429:function(x,E,e){e.d(E,{Z:function(){return i}});var a=e(1413),s=e(67294),m={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64c247.4 0 448 200.6 448 448S759.4 960 512 960 64 759.4 64 512 264.6 64 512 64zm0 76c-205.4 0-372 166.6-372 372s166.6 372 372 372 372-166.6 372-372-166.6-372-372-372zm128.01 198.83c.03 0 .05.01.09.06l45.02 45.01a.2.2 0 01.05.09.12.12 0 010 .07c0 .02-.01.04-.05.08L557.25 512l127.87 127.86a.27.27 0 01.05.06v.02a.12.12 0 010 .07c0 .03-.01.05-.05.09l-45.02 45.02a.2.2 0 01-.09.05.12.12 0 01-.07 0c-.02 0-.04-.01-.08-.05L512 557.25 384.14 685.12c-.04.04-.06.05-.08.05a.12.12 0 01-.07 0c-.03 0-.05-.01-.09-.05l-45.02-45.02a.2.2 0 01-.05-.09.12.12 0 010-.07c0-.02.01-.04.06-.08L466.75 512 338.88 384.14a.27.27 0 01-.05-.06l-.01-.02a.12.12 0 010-.07c0-.03.01-.05.05-.09l45.02-45.02a.2.2 0 01.09-.05.12.12 0 01.07 0c.02 0 .04.01.08.06L512 466.75l127.86-127.86c.04-.05.06-.06.08-.06a.12.12 0 01.07 0z"}}]},name:"close-circle",theme:"outlined"},t=m,v=e(84089),u=function(r,o){return s.createElement(v.Z,(0,a.Z)((0,a.Z)({},r),{},{ref:o,icon:t}))},P=s.forwardRef(u),i=P},51042:function(x,E,e){var a=e(1413),s=e(67294),m=e(42110),t=e(84089),v=function(i,p){return s.createElement(t.Z,(0,a.Z)((0,a.Z)({},i),{},{ref:p,icon:m.Z}))},u=s.forwardRef(v);E.Z=u},40110:function(x,E,e){var a=e(1413),s=e(67294),m=e(509),t=e(84089),v=function(i,p){return s.createElement(t.Z,(0,a.Z)((0,a.Z)({},i),{},{ref:p,icon:m.Z}))},u=s.forwardRef(v);E.Z=u},646:function(x,E,e){var a=e(86738),s=e(85893);E.Z=function(m){var t=m.title,v=m.text,u=m.onConfirm;return(0,s.jsx)(a.Z,{title:t,onConfirm:u,children:(0,s.jsx)("a",{children:v})})}},37594:function(x,E,e){e.d(E,{B:function(){return m}});var a=e(91321),s="//at.alicdn.com/t/font_915840_2b8lahxt5xv.js",m=(0,a.Z)({scriptUrl:s})},84298:function(x,E,e){var a=e(97857),s=e.n(a),m=e(5574),t=e.n(m),v=e(67294),u=e(8232),P=e(17788),i=e(15746),p=e(76081),r=e(85893),o=u.Z.Item,O=function(d){var M=d.title,y=d.width,B=d.left,Z=d.right,I=d.formName,f=d.record,L=d.onFinish,U=d.loading,W=d.fields,F=d.open,K=d.onCancel,S=d.offset,V=S===void 0?0:S,N=d.children,T=d.Footer,$=d.onTest,R=u.Z.useForm(),G=t()(R,1),n=G[0],z=function(){n.validateFields().then(function(b){L(b)})};(0,v.useEffect)(function(){n.resetFields(),n.setFieldsValue(f)},[f]);var Y={labelCol:{span:B},wrapperCol:{span:Z}};return(0,r.jsxs)(P.Z,{style:{marginTop:V},confirmLoading:U,footer:T!==void 0?(0,r.jsx)(T,{onOk:z,onCancel:K,onTest:function(){n.validateFields().then(function(b){$(b)})}}):void 0,title:M,width:y,open:F,onOk:z,onCancel:K,children:[N||null,(0,r.jsx)(u.Z,s()(s()({form:n},Y),{},{name:I,initialValues:f,onFinish:L,children:W.map(function(C,b){return(0,r.jsx)(i.Z,{span:C.span||24,children:(0,r.jsx)(o,{label:C.label,colon:C.colon||!0,initialValue:C.initialValue,rules:[{required:C.required,message:C.message}],name:C.name,valuePropName:C.valuePropName||"value",children:(0,p.Z)(C.type,C.placeholder,C.component)})},b)})}))]})};E.Z=O},76081:function(x,E,e){var a=e(55102),s=e(72269),m=e(67294),t=e(85893),v=a.Z.TextArea,u=function(i,p){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;return r||(i==="input"?(0,t.jsx)(a.Z,{placeholder:p}):i==="textarea"?(0,t.jsx)(v,{placeholder:p}):i==="switch"?(0,t.jsx)(s.Z,{}):null)};E.Z=u},46580:function(x,E,e){e.r(E);var a=e(97857),s=e.n(a),m=e(15009),t=e.n(m),v=e(99289),u=e.n(v),P=e(5574),i=e.n(P),p=e(58841),r=e(34041),o=e(8232),O=e(66309),g=e(96074),d=e(55102),M=e(40411),y=e(14726),B=e(4393),Z=e(38925),I=e(71230),f=e(15746),L=e(72051),U=e(18429),W=e(8751),F=e(40110),K=e(43471),S=e(51042),V=e(90596),N=e(67294),T=e(84298),$=e(19478),R=e(646),G=e(37594),n=e(85893),z=r.Z.Option,Y={labelCol:{span:8},wrapperCol:{span:16}},C=function(w){var A=w.dispatch,H=w.gconfig,re=w.loading,se=o.Z.useForm(),oe=i()(se,1),J=oe[0],le=(0,N.useState)(null),ee=i()(le,2),X=ee[0],ne=ee[1],te=H.envList,_e=H.envMap,ue=H.databaseModal,ie=H.dbConfigData,k=H.databaseRecord,de=re.effects,q=function(c){A({type:"gconfig/save",payload:c})},ae=function(){var l=u()(t()().mark(function c(_){var D;return t()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,A({type:"gconfig/onTestDbConfig",payload:{sql_type:_.sql_type,host:_.host,port:_.port,username:_.username,password:_.password,database:_.database}});case 2:D=h.sent,ne(D);case 4:case"end":return h.stop()}},c)}));return function(_){return l.apply(this,arguments)}}(),ce=function(){var l=u()(t()().mark(function c(){return t()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return A({type:"gconfig/fetchEnvList",payload:{page:1,size:1e4}}),D.next=3,Q();case 3:case"end":return D.stop()}},c)}));return function(){return l.apply(this,arguments)}}(),Q=function(){var l=u()(t()().mark(function c(){var _,D;return t()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,J.getFieldsValue();case 2:_=h.sent,D={name:_.name||"",database:_.database||""},_.env&&(D.env=_.env),A({type:"gconfig/fetchDbConfig",payload:s()({},D)});case 6:case"end":return h.stop()}},c)}));return function(){return l.apply(this,arguments)}}();(0,N.useEffect)(function(){ce()},[]);var me=[{title:"\u73AF\u5883",key:"env",dataIndex:"env",render:function(c){return(0,n.jsx)(O.Z,{children:_e[c]})}},{title:"\u540D\u79F0",key:"name",dataIndex:"name"},{title:"\u5730\u5740",key:"host",dataIndex:"host"},{title:"\u5E93\u540D",key:"database",dataIndex:"database"},{title:"\u7AEF\u53E3\u53F7",key:"port",dataIndex:"port"},{title:"\u5E10\u53F7",key:"username",dataIndex:"username"},{title:"\u5BC6\u7801",key:"password",dataIndex:"password"},{title:"\u7C7B\u578B",key:"sql_type",dataIndex:"sql_type",render:function(c){return c===0?(0,n.jsx)(O.Z,{color:"blue",children:"MySQL"}):c===1?(0,n.jsx)(O.Z,{color:"success",children:"Postgresql"}):(0,n.jsx)(O.Z,{children:"\u672A\u77E5"})}},{title:"\u64CD\u4F5C",key:"ops",render:function(c,_){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("a",{onClick:function(){q({databaseRecord:_,databaseModal:!0})},children:"\u7F16\u8F91"}),(0,n.jsx)(g.Z,{type:"vertical"}),(0,n.jsx)("a",{onClick:function(){ae(_)},children:"\u6D4B\u8BD5"}),(0,n.jsx)(g.Z,{type:"vertical"}),(0,n.jsx)(R.Z,{text:"\u5220\u9664",title:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u914D\u7F6E\u5417?",onConfirm:u()(t()().mark(function D(){return t()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,A({type:"gconfig/deleteDbConfig",payload:{id:_.id}});case 2:return h.next=4,Q();case 4:case"end":return h.stop()}},D)}))})]})}}],Ee=function(){var l=u()(t()().mark(function c(_){return t()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(k.id){j.next=5;break}return j.next=3,A({type:"gconfig/insertDbConfig",payload:s()({},_)});case 3:j.next=7;break;case 5:return j.next=7,A({type:"gconfig/updateDbConfig",payload:s()({id:k.id},_)});case 7:return j.next=9,Q();case 9:case"end":return j.stop()}},c)}));return function(_){return l.apply(this,arguments)}}(),fe=[{name:"sql_type",label:"\u6570\u636E\u5E93\u7C7B\u578B",required:!0,component:(0,n.jsx)(r.Z,{children:Object.keys($.Z.SQL_TYPE).map(function(l){return(0,n.jsx)(z,{value:parseInt(l,10),children:$.Z.SQL_TYPE[l]},l)})}),type:"select"},{name:"env",label:"\u73AF\u5883",required:!0,message:"\u8BF7\u9009\u62E9\u5BF9\u5E94\u73AF\u5883",type:"select",component:(0,n.jsx)(r.Z,{placeholder:"\u8BF7\u9009\u62E9\u5BF9\u5E94\u73AF\u5883",children:te.map(function(l){return(0,n.jsx)(z,{value:l.id,children:l.name},l.id)})})},{name:"name",label:"\u914D\u7F6E\u540D\u79F0",required:!0,message:"\u8BF7\u8F93\u5165\u914D\u7F6E\u540D\u79F0",type:"input",placeholder:"\u8BF7\u8F93\u5165\u914D\u7F6E\u540D\u79F0"},{name:"host",label:"\u5730\u5740",required:!0,message:"\u8BF7\u8F93\u5165host",type:"input",placeholder:"\u8BF7\u8F93\u5165host"},{name:"port",label:"\u7AEF\u53E3",required:!0,message:"\u8BF7\u8F93\u5165port",type:"input",placeholder:"\u8BF7\u8F93\u5165port"},{name:"database",label:"\u5E93\u540D",required:!0,message:"\u8BF7\u8F93\u5165\u6570\u636E\u5E93\u540D",type:"input",placeholder:"\u8BF7\u8F93\u5165\u6570\u636E\u5E93\u540D"},{name:"username",label:"\u5E10\u53F7",required:!0,message:"\u8BF7\u8F93\u5165\u5E10\u53F7",type:"input",placeholder:"\u8BF7\u8F93\u5165\u5E10\u53F7"},{name:"password",label:"\u5BC6\u7801",required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801",component:(0,n.jsx)(d.Z,{type:"password",placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801"})}],ve=function(c){var _=c.onOk,D=c.onCancel,j=c.onTest;return(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{display:"inline-block",lineHeight:"32px",float:"left",marginLeft:4},children:X===null?(0,n.jsx)("span",{children:(0,n.jsx)(M.Z,{status:"default",text:"\u672A\u6D4B\u8BD5\u8FDE\u63A5"})}):(0,n.jsx)(M.Z,{status:X?"success":"error",text:X?"\u6D4B\u8BD5\u8FDE\u63A5\u6210\u529F":"\u6D4B\u8BD5\u8FDE\u63A5\u5931\u8D25"})}),(0,n.jsxs)(y.ZP,{onClick:j,type:"dashed",style:{marginLeft:8},children:[(0,n.jsx)(G.B,{type:"icon-fasong1"})," \u6D4B\u8BD5\u8FDE\u63A5"]}),(0,n.jsxs)(y.ZP,{onClick:D,style:{marginLeft:8},children:[(0,n.jsx)(U.Z,{})," \u53D6\u6D88"]}),(0,n.jsxs)(y.ZP,{onClick:_,type:"primary",children:[(0,n.jsx)(W.Z,{})," \u786E\u5B9A"]})]})};return(0,n.jsx)(p._z,{title:"\u6570\u636E\u5E93\u914D\u7F6E\u5217\u8868",breadcrumb:null,children:(0,n.jsxs)(B.Z,{children:[(0,n.jsx)(T.Z,{Footer:ve,onTest:ae,width:520,record:k,fields:fe,title:"\u6570\u636E\u5E93\u914D\u7F6E",onFinish:Ee,left:6,right:18,open:ue,offset:-50,onCancel:function(){q({databaseModal:!1})},children:(0,n.jsx)(Z.Z,{type:"info",style:{marginBottom:12},closable:!0,message:"\u{1F942} \u5728\u6DFB\u52A0/\u7F16\u8F91\u6570\u636E\u5E93\u914D\u7F6E\u4E4B\u524D\uFF0C\u8BB0\u5F97\u5148\u6D4B\u8BD5\u8FDE\u63A5\u662F\u5426\u53EF\u7528\u54DF\uFF01"})}),(0,n.jsx)(o.Z,s()(s()({},Y),{},{form:J,children:(0,n.jsxs)(I.Z,{gutter:8,children:[(0,n.jsx)(f.Z,{span:6,children:(0,n.jsx)(o.Z.Item,{label:"\u73AF\u5883",name:"env",children:(0,n.jsx)(r.Z,{placeholder:"\u9009\u62E9\u73AF\u5883",allowClear:!0,children:te.map(function(l){return(0,n.jsx)(z,{value:l.id,children:l.name},l.id)})})})}),(0,n.jsx)(f.Z,{span:6,children:(0,n.jsx)(o.Z.Item,{label:"\u914D\u7F6E\u540D",name:"name",children:(0,n.jsx)(d.Z,{placeholder:"\u8F93\u5165\u6570\u636E\u5E93\u914D\u7F6E\u540D"})})}),(0,n.jsx)(f.Z,{span:6,children:(0,n.jsx)(o.Z.Item,{label:"\u6570\u636E\u5E93\u540D",name:"database",children:(0,n.jsx)(d.Z,{placeholder:"\u8F93\u5165\u6570\u636E\u5E93\u540D"})})}),(0,n.jsx)(f.Z,{span:6,children:(0,n.jsxs)("div",{style:{float:"right"},children:[(0,n.jsxs)(y.ZP,{type:"primary",onClick:Q,children:[(0,n.jsx)(F.Z,{}),"\u67E5\u8BE2"]}),(0,n.jsxs)(y.ZP,{style:{marginLeft:8},onClick:u()(t()().mark(function l(){return t()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return J.resetFields(),_.next=3,Q();case 3:case"end":return _.stop()}},l)})),children:[(0,n.jsx)(K.Z,{}),"\u91CD\u7F6E"]})]})})]})})),(0,n.jsx)(I.Z,{style:{marginTop:12},children:(0,n.jsxs)(f.Z,{span:24,children:[(0,n.jsx)(I.Z,{style:{marginBottom:16},children:(0,n.jsxs)(y.ZP,{type:"primary",onClick:function(){q({databaseModal:!0,databaseRecord:{sql_type:0}}),ne(null)},children:[(0,n.jsx)(S.Z,{})," \u6DFB\u52A0\u914D\u7F6E"]})}),(0,n.jsx)(L.Z,{columns:me,dataSource:ie,rowKey:function(c){return c.id},loading:de["gconfig/fetchDbConfig"]})]})})]})})};E.default=(0,V.connect)(function(b){var w=b.loading,A=b.gconfig;return{loading:w,gconfig:A}})(C)}}]);
